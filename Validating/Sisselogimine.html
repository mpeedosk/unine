<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Sisselogimine</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Core JavaScript -->
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script>
        if (typeof jQuery == 'undefined') {
            document.write(decodeURI("%3Cscript src='/js/jquery-2.2.2.min.js' type='text/javascript'%3E%3C/script%3E"));
        }
    </script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/animsition.min.js"></script>
    <script src="js/main.js"></script>

    <!-- Social Buttons CSS -->
    <link href="css/main.css" rel="stylesheet">
    <link href="css/morning.css" rel="stylesheet">

    <link rel='stylesheet' href='css/animsition.min.css'>


    <script>
        getStylesheet();
    </script>

    <script>
        function goBack() {
            window.history.back();
        }
    </script>


</head>

<body class="animsition">
<!-- Login Modal CSS-->

<div class="container">
    <div class="row">

        <div class="col-md-6 col-md-offset-3">

            <div class="reg-panel ">
                <div class="panel-header">
                    <button type="button" class="close">
                        <span onclick="goBack()" class="animsition-link" aria-hidden="true">&larr;</span><span
                                class="sr-only">Tagasi</span>
                    </button>
                    <img src="img/pillow.svg" alt="logo">
                    <h3 class="modal-title" id="modal-login-label">Registreerimine
                    </h3>
                </div>

                <div class="panel-body">

                    <form method="POST" action="http://localhost:8000/register" class="form-horizontal">
                        <input type="hidden" name="_token" value="EYDcI61pWiM28Ur9ikKAyXBJGT9d0HxzYb8MNYQg">

                        <div class="form-group">

                            <label for="username" class="col-md-4 control-label">Kasutajatunnus</label>

                            <div class="col-md-7">
                                <input id="username" type="text" class="form-control" name="username"
                                       value="" onBlur="checkAvailabilityUser()">

                                                            </div>
                            <span id="user-availability-status"></span>
                        </div>

                        <div class="form-group">
                            <label for="first_name" class="col-md-4 control-label">Eesnimi</label>

                            <div class="col-md-7">
                                <input id="first_name" type="text" class="form-control" name="first_name"
                                       value="">

                                                            </div>
                        </div>

                        <div class="form-group">
                            <label for="last_name" class="col-md-4 control-label">Perenimi</label>
                            <div class="col-md-7">
                                <input id="last_name" type="text" class="form-control" name="last_name"
                                       value="">

                                                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email" class="col-md-4 control-label">Meiliaadress</label>

                            <div class="col-md-7">
                                <input id="email" type="email" class="form-control" name="email"
                                       value="" onBlur="checkAvailabilityEmail()">

                                                            </div>
                            <span id="email-availability-status"></span>
                        </div>

                        <div class="form-group">
                            <label for="password" class="col-md-4 control-label">Salasõna</label>

                            <div class="col-md-7">
                                <input id="password" type="password" class="form-control" name="password"
                                       onBlur="validatePassword()">

                                                            </div>
                            <span id="password-status"></span>
                        </div>

                        <div class="form-group">
                            <label for="pw-confirm" class="col-md-4 control-label">Kinnitage salasõna</label>

                            <div class="col-md-7">
                                <input id="pw-confirm" type="password" class="form-control"
                                       name="password_confirmation">

                                                            </div>
                        </div>
                        <br>
                        <button type="submit" class="btn button center-block ">Loo konto</button>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function checkAvailabilityUser() {

        var username = $("#username").val();
        if (username.length > 0) {
            jQuery.ajax({
                url: "checkUser",
                data: {
                    _token: $('input[name="_token"]').val(),
                    username: username
                },
                type: "POST",
                success: function (data) {
                    console.log(data);
                    if (data.response == "true") {
                        $('#username').css({"border": "1px solid #16E241", "box-shadow": "0 0 10px #2af44e"});
                        $("#user-availability-status").html("<span class='glyphicon glyphicon-ok' style='margin-top: 10px'></span>");
                        console.log("true");
                    }
                    else {
                        $('#username').css({'border': '1px solid #e22e27', 'box-shadow': '0 0 10px #e22e27'});
                        $("#user-availability-status").html("<span class='glyphicon glyphicon-remove' style='margin-top: 10px'></span>");

                    }
                },
                error: function () {
                }
            });
        }
    }

    function checkAvailabilityEmail() {

        var email = $("#email").val();

        if (validateEmail(email)) {
            jQuery.ajax({
                url: "checkEmail",
                data: {
                    _token: $('input[name="_token"]').val(),
                    email: email
                },
                type: "POST",
                success: function (data) {
                    if (data.response == "true") {
                        $('#email').css({"border": "1px solid #16E241", "box-shadow": "0 0 10px #2af44e"});
                        $("#email-availability-status").html("<span class='glyphicon glyphicon-ok' style='margin-top: 10px'></span>");
                    }
                    else {
                        $("#email").css({'border': '1px solid #e22e27', 'box-shadow': '0 0 10px #e22e27'});
                        $("#email-availability-status").html("<span class='glyphicon glyphicon-remove' style='margin-top: 10px'></span>");

                    }
                },
                error: function () {
                }
            });
        } else {
            $("#email").css({'border': '1px solid #e22e27', 'box-shadow': '0 0 10px #e22e27'});
            $("#email-availability-status").html("<span class='glyphicon glyphicon-remove' style='margin-top: 10px'></span>");
        }
    }

    function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }
    function validatePassword() {
        var password = $("#password").val();
        if (password.length >= 6) {
            $('#password').css({"border": "1px solid #16E241", "box-shadow": "0 0 10px #2af44e"});
            $("#password-status").html("<span class='glyphicon glyphicon-ok' style='margin-top: 10px'></span>");
        } else {
            $("#password").css({'border': '1px solid #e22e27', 'box-shadow': '0 0 10px #e22e27'});
            $("#password-status").html("<span class='glyphicon glyphicon-remove' style='margin-top: 10px'></span>");

        }
    }
</script>

</body>

</html>
